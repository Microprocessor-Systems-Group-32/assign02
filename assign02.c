#include <stdio.h>
#include <stdlib.h>

#include "pico/stdlib.h"
#include "hardware/pio.h"
#include "hardware/clocks.h"
//#include "ws2812.pio.h"

#define IS_RGBW true        // Will use RGBW format
#define NUM_PIXELS 1        // There is 1 WS2812 device in the chain
#define WS2812_PIN 28       // The GPIO pin that the WS2812 connected to

/**
 * @brief Wrapper function used to call the underlying PIO
 *        function that pushes the 32-bit RGB colour value
 *        out to the LED serially using the PIO0 block. The
 *        function does not return until all of the data has
 *        been written out.
 * 
 * @param pixel_grb The 32-bit colour value generated by urgb_u32()
 */
static inline void put_pixel(uint32_t pixel_grb) {
    pio_sm_put_blocking(pio0, 0, pixel_grb << 8u);
}


/**
 * @brief Function to generate an unsigned 32-bit composit GRB
 *        value by combining the individual 8-bit paramaters for
 *        red, green and blue together in the right order.
 * 
 * @param r     The 8-bit intensity value for the red component
 * @param g     The 8-bit intensity value for the green component
 * @param b     The 8-bit intensity value for the blue component
 * @return uint32_t Returns the resulting composit 32-bit RGB value
 */
static inline uint32_t urgb_u32(uint8_t r, uint8_t g, uint8_t b) {
    return  ((uint32_t) (r) << 8)  |
            ((uint32_t) (g) << 16) |
            (uint32_t) (b);
}

// Must declare the main assembly entry point before use.
void main_asm();

// Initialise GPIO pin
void asm_gpio_init(uint pin)
{
    gpio_init(pin);
}

// Set direction of a GPIO pin
void asm_gpio_set_dir(uint pin, bool out)
{
    gpio_set_dir(pin, out);
}

// Get the value of a GPIO pin
bool asm_gpio_get(uint pin)
{
    return gpio_get(pin);
}

// Set the value of a GPIO pin
void asm_gpio_put(uint pin, bool value)
{
    gpio_put(pin, value);
}

// Set the IRQ of a GPIO pin
void asm_gpio_set_irq(uint pin)
{
    gpio_set_irq_enabled(pin, GPIO_IRQ_EDGE_FALL, true);
}

struct letter {
    char letter; // char representation of letter
    char *morse_code; // morse code representation of letter, in binary string format
};

// Creates an instance of letter.
struct letter letter_create(char letter, char *morse_code) {
    struct letter output;
    output.letter = letter;
    output.morse_code = morse_code;
    return output;
}

struct letter letter_array[37];
void letter_array_create() {
    letter_array[0] = letter_create('A',".-");
    letter_array[1] = letter_create('B',"-...");
    letter_array[2] = letter_create('C',"-.-.");
    letter_array[3] = letter_create('D',"-..");
    letter_array[4] = letter_create('E',".");
    letter_array[5] = letter_create('F',"..-.");
    letter_array[6] = letter_create('G',"--.");
    letter_array[7] = letter_create('H',"....");
    letter_array[8] = letter_create('I',"..");
    letter_array[9] = letter_create('J',".---");
    letter_array[10] = letter_create('K',"-.-");
    letter_array[11] = letter_create('L',".-..");
    letter_array[12] = letter_create('M',"--");
    letter_array[13] = letter_create('N',"-.");
    letter_array[14] = letter_create('O',"---");
    letter_array[15] = letter_create('P',".--.");
    letter_array[16] = letter_create('Q',"--.-");
    letter_array[17] = letter_create('R',".-.");
    letter_array[18] = letter_create('S',"...");
    letter_array[19] = letter_create('T',"-");
    letter_array[20] = letter_create('U',"..-");
    letter_array[21] = letter_create('V',"...-");
    letter_array[22] = letter_create('W',".--");
    letter_array[23] = letter_create('X',"-..-");
    letter_array[24] = letter_create('Y',"-.--");
    letter_array[25] = letter_create('Z',"--..");
    letter_array[26] = letter_create('0',"-----");
    letter_array[27] = letter_create('1',".----");
    letter_array[28] = letter_create('2',"..---");
    letter_array[29] = letter_create('3',"...--");
    letter_array[30] = letter_create('4',"....-");
    letter_array[31] = letter_create('5',".....");
    letter_array[32] = letter_create('6',"-....");
    letter_array[33] = letter_create('7',"--...");
    letter_array[34] = letter_create('8',"---..");
    letter_array[35] = letter_create('9',"----.");
    letter_array[36] = letter_create('?',"..--..");
}

struct player
{
    int currentRound; 
    int highestRound;
    int lives; 
    int wins; 
    int totalCorrectAnswers;
};

void playerReset(struct player * player) {
    player->currentRound = 0;
    player->highestRound = 0;
    player->lives = 3;
    player->wins = 0;
    player->totalCorrectAnswers = 0;
}


/**
 * @brief EXAMPLE - WS2812_RGB
 *        Simple example to initialise the NeoPixel RGB LED on
 *        the MAKER-PI-PICO and then flash it in alternating
 *        colours between red, green and blue forever using
 *        one of the RP2040 built-in PIO controllers.
 * 
 * @return int  Application return code (zero for success).
 */
int main()
{
    // Initialise all STDIO as we will be using the GPIOs
     stdio_init_all();

    // Initialise the PIO interface with the WS2812 code
    // PIO pio = pio0;
    // uint offset = pio_add_program(pio, &ws2812_program);
    // ws2812_program_init(pio, 0, offset, WS2812_PIN, 800000, IS_RGBW);


    // Initialise the array of letters
    letter_array_create();

        printf("__        _______ _     ____ ___  __  __ _____ \n");
        printf("\\ \\      / / ____| |   / ___/ _ \\|  \\/  | ____| \n");
        printf(" \\ \\ /\\ / /|  _| | |  | |  | | | | |\\/| |  _|  \n");
        printf("  \\ V  V / | |___| |__| |__| |_| | |  | | |___  \n");
        printf("   \\_/\\_/  |_____|_____\\____\\___/|_|  |_|_____| \n");
        printf("  ____ ____   ___  _   _ ____    _________  \n");
        printf(" / ___|  _ \\ / _ \\| | | |  _ \\  |___ /___ \\ \n");
        printf("| |  _| |_) | | | | | | | |_) |   |_ \\ __) | \n");
        printf("| |_| |  _ <| |_| | |_| |  __/   ___) / __/ \n");
        printf(" \\____|_|\\_  \\___/ \\___/|_|     |____/_____| \n");

        printf("\n       WELCOME TO OUR MORSE CODE GAME!        \n");
        printf("       PRESS THE GPIO PIN 21 TO CONTINUE        \n");

// coontinue if pin is pressed
if(true){
        printf("\n                 HOW TO PLAY\n");
        printf("You must enter the correct morse code sequence \n");
        printf("There are 4 levels in total - each level is 5 rounds!\n");
        printf("You have 3 lives before the game is over. \n");
        printf("\n");
        printf("1. For a dot (.), Hold down GPIO PIN 21 <0.25s \n");
        printf("2. For a dash (-), Hold down GPIO PIN 21 for >0.25s \n");
        printf("3. For a space, Leave the button unpressed for 1s \n");
        printf("4. To submit, Leave the button unpressed for 2s \n");
        printf("\n");
        printf("\n           CHOOSE YOUR DIFFICULTY: \n");
        printf("\n");
        printf("            LEVEL 1: PRESS 1 TIME\n");
        printf("            LEVEL 2: PRESS 2 TIMES\n");
        printf("            LEVEL 3: PRESS 3 TIMES\n");
        printf("            LEVEL 4: PRESS 4 TIMES\n");

        
}

    while(true) {
        /*
        // Set the color to red at half intensity
        put_pixel(urgb_u32(0x7F, 0x00, 0x00));
        sleep_ms(500);

        // Set the color to green at half intensity
        put_pixel(urgb_u32(0x00, 0x7F, 0x00));
        sleep_ms(500);

        // Set the color to blue at half intensity
        put_pixel(urgb_u32(0x00, 0x00, 0x7F));
        sleep_ms(500);
        */
        
        // Call the main assembly function
        main_asm();
    }

    return (0);
}